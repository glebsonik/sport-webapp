<%
  # Controllers that use this partial must provide the following variables:
  # comment
  # user

  thread = comment.thread
%>

<% if comment.can_be_voted_on? && comment.can_be_voted_on_by?(user) %>
  <% can_vote = comment.can_be_voted_on_by?(user) %>
  <% vote = comment.get_vote_by(user) %>
  <% comment_voting = thread.config.comment_voting.to_sym %>

  <% if comment_voting == :ld || comment_voting == :l %>
  <% vtype = (comment_voting == :ld) ? 'upvote' : 'like' %>
  <span id="commontator-comment-<%= comment.id %>-upvotes-container" class="vote-container">
    <span id="commontator-comment-<%= comment.id %>-<%= vtype %>" class="<%= vtype %>">
      <% if can_vote && (vote.blank? || !vote.vote_flag) %>
        <%= form_tag commontator.upvote_comment_path(comment),
              method: :put,
              remote: true do %>
          <%= button_tag :submit, style: 'all: unset;' do %>
            <%= File.read("app/assets/images/svgs/like_inactive.svg").html_safe%>
          <% end %>
        <% end %>
      <% elsif can_vote %>
        <%= form_tag commontator.unvote_comment_path(comment),
              method: :put,
              remote: true do %>
          <%= button_tag :submit, style: 'all: unset;' do %>
            <%= File.read("app/assets/images/svgs/like_active.svg").html_safe%>
          <% end %>
        <% end %>
      <% end %>
    </span>
    <span id="commontator-comment-<%= comment.id %>-vote-count" class="vote-count">
      <% config = thread.config %>
        <%= config.vote_count_proc.call(thread, comment.cached_votes_up, comment.cached_votes_down).split('|')[0].strip %>
    </span>
  </span>
  <% end %>

  <% if comment_voting == :ld %>
  <span id="commontator-comment-<%= comment.id %>-downvotes-container" class="vote-container">
    <span id="commontator-comment-<%= comment.id %>-downvote" class="downvote">
      <% if can_vote && (vote.blank? || vote.vote_flag) %>
        <%= form_tag commontator.downvote_comment_path(comment),
              method: :put,
              remote: true do %>
          <%= button_tag :submit, style: 'all: unset;' do %>
            <%= File.read("app/assets/images/svgs/dislike_inactive.svg").html_safe%>
          <% end %>
        <% end %>
      <% elsif can_vote %>
        <%= form_tag commontator.unvote_comment_path(comment),
              method: :put,
              remote: true do %>
          <%= button_tag :submit, style: 'all: unset;' do %>
            <%= File.read("app/assets/images/svgs/dislike_active.svg").html_safe%>
          <% end %>
        <% end %>
      <% end %>
    </span>
    <span id="commontator-comment-<%= comment.id %>-vote-count" class="vote-count">
      <% config = thread.config %>
        <%= config.vote_count_proc.call(thread, comment.cached_votes_up, comment.cached_votes_down).split('|')[1].strip %>
    </span>
  </span>
  <% end %>
<% end %>
